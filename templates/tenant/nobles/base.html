<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{% block meta_description %}نوبلز العقارية - شركة تطوير عقاري عالمية{% endblock %}">
    <meta name="keywords" content="نوبلز، عقارات، تطوير عقاري، الأردن، دبي، مشاريع سكنية">
    <meta name="author" content="Nobles Properties">
    
    <title>{% block title %}نوبلز العقارية{% endblock %}</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='images/favicon.svg') }}">
    
    <!-- Google Fonts - Tajawal -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    
    <!-- Bootstrap RTL -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Flag Icons CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.0.0/css/flag-icons.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    {% block extra_css %}{% endblock %}
    
    <!-- Print CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/print.css') }}" media="print">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('index') }}">
                <img src="{{ url_for('static', filename='images/logo.svg') }}" alt="نوبلز العقارية" height="40">
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'index' %}active{% endif %}" href="{{ url_for('index') }}">
                            <i class="fas fa-home"></i> الرئيسية
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'projects' %}active{% endif %}" href="{{ url_for('projects') }}">
                            <i class="fas fa-building"></i> المشاريع
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.endpoint == 'about' %}active{% endif %}" href="{{ url_for('about') }}">
                            <i class="fas fa-info-circle"></i> من نحن
                        </a>
                    </li>
                </ul>
                
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="https://noblesproperties.com" target="_blank">
                            <i class="fas fa-external-link-alt"></i> الموقع الرسمي
                        </a>
                    </li>
                    <!-- زر إدارة المستخدمين (للأدمن فقط) -->
                    <li class="nav-item" id="adminUsersNavItem" style="display: none;">
                        <a class="nav-link" href="#" onclick="openUsersModal()" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 8px; padding: 8px 15px !important; position: relative;">
                            <i class="fas fa-users-cog"></i> إدارة الأعضاء
                            <span id="nav-pending-badge" style="position: absolute; top: -5px; right: -5px; background: #ef4444; color: white; font-size: 0.65rem; min-width: 18px; height: 18px; border-radius: 50%; display: none; align-items: center; justify-content: center; font-weight: bold;">0</span>
                        </a>
                    </li>
                    <!-- زر تسجيل الدخول/الخروج -->
                    <li class="nav-item" id="authNavItem" style="display: none;">
                        <a class="nav-link" href="#" id="authNavLink" onclick="handleAuthClick()">
                            <i class="fas fa-user" id="authIcon"></i> <span id="authText">تسجيل الدخول</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main>
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-4">
                    <div class="footer-brand">
                        <img src="{{ url_for('static', filename='images/logo.svg') }}" alt="نوبلز العقارية" height="50">
                        <p class="mt-3">
                            شركة تطوير عقاري عالمية تأسست في دبي عام 2008. نمتلك ونقوم بتطوير وإدارة العقارات السكنية والتجارية.
                        </p>
                    </div>
                </div>
                
                <div class="col-lg-2 col-md-4 mb-4">
                    <h5>روابط سريعة</h5>
                    <ul class="footer-links">
                        <li><a href="{{ url_for('index') }}">الرئيسية</a></li>
                        <li><a href="{{ url_for('projects') }}">المشاريع</a></li>
                        <li><a href="{{ url_for('about') }}">من نحن</a></li>
                    </ul>
                </div>
                
                <div class="col-lg-3 col-md-4 mb-4">
                    <h5>تواصل معنا</h5>
                    <ul class="footer-contact">
                        <li>
                            <i class="fas fa-map-marker-alt"></i>
                            <span>عمان، الأردن<br>أبراج الحجاز، مكتب 406، شارع مكة</span>
                        </li>
                        <li>
                            <i class="fas fa-phone"></i>
                            <a href="tel:+96265546161">+962 (06) 5546161</a>
                        </li>
                        <li>
                            <i class="fas fa-envelope"></i>
                            <a href="mailto:info@noblesproperties.com">info@noblesproperties.com</a>
                        </li>
                    </ul>
                </div>
                
                <div class="col-lg-3 col-md-4 mb-4">
                    <h5>تابعنا</h5>
                    <div class="social-links">
                        <a href="https://www.facebook.com/Noblesproperties" target="_blank" title="Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://www.instagram.com/noblesproperties/" target="_blank" title="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="https://www.youtube.com/@noblesproperties" target="_blank" title="YouTube">
                            <i class="fab fa-youtube"></i>
                        </a>
                        <a href="https://x.com/NoblesGroup_" target="_blank" title="X (Twitter)">
                            <i class="fab fa-x-twitter"></i>
                        </a>
                    </div>
                </div>
            </div>
            
            <hr>
            
            <div class="row align-items-center">
                <div class="col-md-4">
                    <p class="copyright mb-0">
                        © {{ now().year if now is defined else '2025' }} نوبلز العقارية. جميع الحقوق محفوظة.
                    </p>
                </div>
                <div class="col-md-4 text-center my-3 my-md-0">
                    <div style="display: inline-flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.05); padding: 8px 16px; border-radius: 8px;">
                        <span style="font-size: 0.85rem; color: #ffffff;">الاستشاري الاتصالي</span>
                        <img src="{{ url_for('static', filename='images/Logo-Turjuman1.png') }}" alt="ترجمان" style="height: 30px; filter: brightness(1.1);">
                    </div>
                </div>
                <div class="col-md-4 text-md-start">
                    <a href="https://noblesproperties.com/ar/terms-of-use" target="_blank">شروط الاستخدام</a>
                    <span class="mx-2">|</span>
                    <a href="https://noblesproperties.com/ar/privacy-policy" target="_blank">سياسة الخصوصية</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    
    <!-- html2pdf for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDcJ14KaBqyVrHlSGqrf4SXY8nw61c218Q",
            authDomain: "nobles-c3e07.firebaseapp.com",
            projectId: "nobles-c3e07",
            storageBucket: "nobles-c3e07.firebasestorage.app",
            messagingSenderId: "110014465208",
            appId: "1:110014465208:web:2bae52630c6729df6a604d",
            measurementId: "G-YDEWJPBC45"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        // Google Auth Provider
        const googleProvider = new firebase.auth.GoogleAuthProvider();
        
        // تسجيل الدخول بـ Google
        function signInWithGoogle() {
            auth.signInWithPopup(googleProvider)
                .then((result) => {
                    console.log('تم تسجيل الدخول:', result.user.email);
                    // إعادة تحميل الصفحة بعد تسجيل الدخول
                    window.location.reload();
                })
                .catch((error) => {
                    console.error('خطأ في تسجيل الدخول:', error);
                    alert('حدث خطأ في تسجيل الدخول. يرجى المحاولة مرة أخرى.');
                });
        }
        
        // تسجيل الخروج
        function signOut() {
            auth.signOut().then(() => {
                console.log('تم تسجيل الخروج');
                window.location.href = '/';
            });
        }
        
        // التحقق من حالة تسجيل الدخول
        function checkAuthForProtectedPage() {
            return new Promise((resolve) => {
                auth.onAuthStateChanged((user) => {
                    resolve(user);
                });
            });
        }
        
        // تحديث حالة زر تسجيل الدخول في شريط التنقل
        const ADMIN_EMAILS = ['taher.irshaid@gmail.com', 'admin@nobles.sa'];
        let isLoggedIn = false;
        
        auth.onAuthStateChanged(async (user) => {
            const authNavItem = document.getElementById('authNavItem');
            const authText = document.getElementById('authText');
            const authIcon = document.getElementById('authIcon');
            const adminUsersNavItem = document.getElementById('adminUsersNavItem');
            
            if (authNavItem) {
                authNavItem.style.display = 'block';
                if (user) {
                    isLoggedIn = true;
                    authText.textContent = 'تسجيل الخروج';
                    authIcon.className = 'fas fa-sign-out-alt';
                    
                    // التحقق من صلاحية الأدمن
                    if (adminUsersNavItem && ADMIN_EMAILS.includes(user.email.toLowerCase())) {
                        adminUsersNavItem.style.display = 'block';
                        // تحديث شارة الطلبات المعلقة
                        updateNavPendingBadge();
                    }
                } else {
                    isLoggedIn = false;
                    authText.textContent = 'تسجيل الدخول';
                    authIcon.className = 'fas fa-sign-in-alt';
                    if (adminUsersNavItem) adminUsersNavItem.style.display = 'none';
                }
            }
        });
        
        // تحديث شارة الطلبات المعلقة في الـ navbar
        async function updateNavPendingBadge() {
            try {
                const pendingSnapshot = await db.collection('users').where('status', '==', 'pending').get();
                const count = pendingSnapshot.size;
                const badge = document.getElementById('nav-pending-badge');
                if (badge) {
                    if (count > 0) {
                        badge.textContent = count;
                        badge.style.display = 'flex';
                    } else {
                        badge.style.display = 'none';
                    }
                }
            } catch (error) {
                console.error('خطأ في تحديث شارة الطلبات:', error);
            }
        }
        
        function handleAuthClick() {
            if (isLoggedIn) {
                signOut();
            } else {
                window.location.href = '/login';
            }
        }
        
        // فتح نافذة إدارة المستخدمين
        function openUsersModal() {
            // إذا كانت الدالة موجودة في الصفحة الحالية (صفحة التقرير)
            if (typeof window.openUsersModalInternal === 'function') {
                window.openUsersModalInternal();
            } else {
                // الانتقال إلى صفحة التقرير مع فتح modal المستخدمين
                window.location.href = '/report/alic-almuwaqqar?openUsers=true';
            }
        }
    </script>
    
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>
