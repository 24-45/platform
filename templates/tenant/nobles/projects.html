{% extends 'tenant/nobles/base.html' %}

{% block title %}المشاريع - نوبلز العقارية{% endblock %}

{% block meta_description %}استكشف مشاريع نوبلز العقارية - مرتفعات الدانة، مدينة السيارات، لؤلؤة عبدون، أليك، نوبلز هايتس، أبو علاندا{% endblock %}

{% block extra_css %}
<style>
    /* شاشة التحميل/التحقق من تسجيل الدخول */
    .auth-loading {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--gray-100);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
    }
    .auth-loading .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid var(--gray-300);
        border-top-color: var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    .page-content { display: none; }
    .page-content.visible { display: block; }
</style>
{% endblock %}

{% block content %}
<!-- شاشة التحميل -->
<div class="auth-loading" id="authLoading">
    <div class="spinner"></div>
</div>

<!-- محتوى الصفحة -->
<div class="page-content" id="pageContent">
<!-- Page Header -->
<section class="page-header">
    <div class="container">
        <div class="page-header-content">
            <h1>مشاريعنا</h1>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('tenant_home', tenant_slug='nobles') }}">الرئيسية</a></li>
                    <li class="breadcrumb-item active">المشاريع</li>
                </ol>
            </nav>
        </div>
    </div>
</section>

<!-- Projects Filter -->
<section class="projects-filter-section">
    <div class="container">
        <div class="filter-buttons">
            <button class="filter-btn active" data-filter="all">الكل</button>
            <button class="filter-btn" data-filter="active">المشاريع النشطة</button>
            <button class="filter-btn" data-filter="residential">سكني</button>
            <button class="filter-btn" data-filter="commercial">تجاري</button>
        </div>
    </div>
</section>

<!-- Projects Grid -->
<section class="projects-section">
    <div class="container">
        <div class="row" id="projects-grid">
            {% for project in projects %}
            <div class="col-lg-4 col-md-6 mb-4 project-item" 
                 data-type="{{ 'residential' if 'سكني' in project.type else 'commercial' }}"
                 data-active="{{ 'active' if project.active else 'inactive' }}">
                <div class="project-card {% if not project.active %}project-card-inactive{% endif %}">
                    <div class="project-image">
                        <img src="{{ url_for('static', filename='images/tenants/nobles/projects/' + project.images.main) }}" 
                             alt="{{ project.name }}"
                             onerror="this.src='{{ url_for('static', filename='images/tenants/nobles/placeholder.jpg') }}'">
                        {% if project.featured %}
                        <span class="project-badge featured">جاري العمل</span>
                        {% endif %}
                        {% if not project.active %}
                        <span class="project-badge coming-soon">قريباً</span>
                        {% else %}
                        <span class="project-badge status">{{ project.status }}</span>
                        {% endif %}
                        <div class="project-overlay">
                            {% if project.active %}
                            <a href="{{ url_for('project_report', slug=project.slug) }}" class="btn btn-light">
                                <i class="fas fa-bullhorn"></i> خطة الاتصال
                            </a>
                            {% endif %}
                        </div>
                    </div>
                    <div class="project-info">
                        <div class="project-type-badge">{{ project.type }}</div>
                        <h3 class="project-name">{{ project.name }}</h3>
                        <p class="project-name-en">{{ project.name_en }}</p>
                        <p class="project-description">{{ project.description[:100] }}{% if project.description|length > 100 %}...{% endif %}</p>
                        <div class="project-meta">
                            <span><i class="fas fa-map-marker-alt"></i> {{ project.location }}</span>
                        </div>
                        {% if project.active %}
                        <div class="project-actions">
                            <a href="{{ url_for('project_report', slug=project.slug) }}" class="btn btn-primary btn-sm">
                                <i class="fas fa-bullhorn"></i> خطة الاتصال
                            </a>
                        </div>
                        {% else %}
                        <div class="project-coming-soon-text">
                            <i class="fas fa-clock"></i> قريباً - سيتم العمل على إعداد خطة الاتصال
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
// Project filtering
document.addEventListener('DOMContentLoaded', function() {
    const filterButtons = document.querySelectorAll('.filter-btn');
    const projectItems = document.querySelectorAll('.project-item');
    
    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Update active button
            filterButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            
            const filter = this.dataset.filter;
            
            projectItems.forEach(item => {
                if (filter === 'all') {
                    item.style.display = 'block';
                } else if (filter === 'active') {
                    item.style.display = item.dataset.active === 'active' ? 'block' : 'none';
                } else {
                    item.style.display = item.dataset.type === filter ? 'block' : 'none';
                }
            });
        });
    });
});

// التحقق من تسجيل الدخول
const bypassCode = new URLSearchParams(window.location.search).get('access');
if (bypassCode === 'nobles2025') {
    // تجاوز تسجيل الدخول
    document.getElementById('authLoading').style.display = 'none';
    document.getElementById('pageContent').classList.add('visible');
} else {
    auth.onAuthStateChanged((user) => {
        const authLoading = document.getElementById('authLoading');
        const pageContent = document.getElementById('pageContent');
        
        if (user) {
            // المستخدم مسجل دخوله - إظهار المحتوى
            authLoading.style.display = 'none';
            pageContent.classList.add('visible');
        } else {
            // المستخدم غير مسجل - توجيهه لصفحة تسجيل الدخول
            window.location.href = '/login?redirect=' + encodeURIComponent(window.location.pathname);
        }
    });
}
</script>
</div>
{% endblock %}
